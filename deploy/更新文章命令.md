# 阿里云服务器更新文章命令

## 方法一：完整同步（推荐）

在服务器上执行以下命令，会自动拉取最新代码并导入文章：

```bash
cd /var/www/my-fullstack-app
bash deploy/阿里云服务器直接执行命令.sh
```

或者使用另一个同步脚本：

```bash
cd /var/www/my-fullstack-app
bash deploy/sync-on-server-complete.sh
```

这两个脚本会自动：
1. 从 Gitee 拉取最新代码（包括 `data/articles.json`）
2. 更新依赖
3. 初始化数据库
4. **自动导入文章数据**
5. 构建前端
6. 重启服务

## 方法二：仅更新文章（代码已同步）

如果代码已经同步，只需要导入文章数据：

```bash
cd /var/www/my-fullstack-app/backend
source ../venv/bin/activate
python import_articles.py
```

## 方法三：手动执行完整流程

如果需要手动控制每个步骤：

```bash
# 1. 进入项目目录
cd /var/www/my-fullstack-app

# 2. 处理本地修改（如果有）
git stash push -m "backup-$(date +%Y%m%d_%H%M%S)" 2>/dev/null || true

# 3. 拉取最新代码
git fetch gitee main
git reset --hard gitee/main

# 4. 激活虚拟环境
source venv/bin/activate

# 5. 更新依赖（如果需要）
cd backend
pip install -r requirements.txt --quiet

# 6. 导入文章数据
python import_articles.py

# 7. 构建前端（如果需要）
cd ../frontend
npm install --silent
npm run build

# 8. 重启服务
cd ..
sudo systemctl restart my-fullstack-app
sudo systemctl restart nginx

# 9. 验证服务
sleep 3
curl http://127.0.0.1:8000/api/health
```

## 方法四：一键执行（复制粘贴）

将以下所有命令复制到服务器终端一次性执行：

```bash
cd /var/www/my-fullstack-app && \
git stash push -m "backup-$(date +%Y%m%d_%H%M%S)" 2>/dev/null || true && \
git fetch gitee main && \
git reset --hard gitee/main && \
source venv/bin/activate && \
cd backend && \
python import_articles.py && \
cd .. && \
sudo systemctl restart my-fullstack-app && \
sudo systemctl restart nginx && \
echo "文章更新完成！"
```

## 验证更新

更新后，可以通过以下方式验证：

```bash
# 检查后端服务状态
sudo systemctl status my-fullstack-app --no-pager -l | head -20

# 测试 API
curl http://127.0.0.1:8000/api/articles

# 查看文章数量
cd /var/www/my-fullstack-app/backend
source ../venv/bin/activate
python -c "from database import SessionLocal; from models import Article; db = SessionLocal(); print(f'文章总数: {db.query(Article).count()}'); db.close()"
```

## 注意事项

1. **文章更新策略**：`import_articles.py` 默认会更新已存在的文章（根据标题和发布时间判断）
2. **数据备份**：建议在更新前备份数据库（如果使用 MySQL）
3. **服务重启**：导入文章后需要重启后端服务才能看到最新内容
4. **权限问题**：如果遇到权限问题，使用 `sudo` 执行相关命令

